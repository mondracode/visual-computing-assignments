<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Depth of field # Introduction # This effect describes the distance between the nearest and farthest objects in a scene that appear acceptably sharp in an image. The depth of field is affected by the focal length of the lens, the aperture of the lens, and the distance between the subject and the camera.
Antecedents # The depth of field is affected by the focal length of the lens, the aperture of the lens, the distance between the subject and the camera, and the acceptable circle of confusion."><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content="1. Depth of Field"><meta property="og:description" content="Depth of field # Introduction # This effect describes the distance between the nearest and farthest objects in a scene that appear acceptably sharp in an image. The depth of field is affected by the focal length of the lens, the aperture of the lens, and the distance between the subject and the camera.
Antecedents # The depth of field is affected by the focal length of the lens, the aperture of the lens, the distance between the subject and the camera, and the acceptable circle of confusion."><meta property="og:type" content="article"><meta property="og:url" content="https://mondracode.com/visual-computing-assignments/docs/visual-illusions/depth-of-field/"><meta property="article:section" content="docs"><meta property="article:modified_time" content="2023-04-29T11:34:31-05:00"><title>1. Depth of Field | Visual Computing Assignments</title><link rel=manifest href=/visual-computing-assignments/manifest.json><link rel=icon href=/visual-computing-assignments/favicon.png type=image/x-icon><link rel=stylesheet href=/visual-computing-assignments/book.min.f645590089b7c16b44348afb99c091ff439d5d03ced854740aa04e373e37a0dd.css integrity="sha256-9kVZAIm3wWtENIr7mcCR/0OdXQPO2FR0CqBONz43oN0=" crossorigin=anonymous><script defer src=/visual-computing-assignments/flexsearch.min.js></script>
<script defer src=/visual-computing-assignments/en.search.min.806061c597a3647b7ff8d5fe4fc7297c9d8128cef96a8504fda277c7763ee617.js integrity="sha256-gGBhxZejZHt/+NX+T8cpfJ2BKM75aoUE/aJ3x3Y+5hc=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/visual-computing-assignments/><span>Visual Computing Assignments</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li class=book-section-flat><span>Rendering and Space Transformation</span><ul><li><a href=/visual-computing-assignments/docs/rendering-and-space-transformation/light/>1. Lights</a></li><li><a href=/visual-computing-assignments/docs/rendering-and-space-transformation/raycast-rendering/>2. Rendering by raycasting</a></li><li><a href=/visual-computing-assignments/docs/rendering-and-space-transformation/post-effects/>3. Post Effects</a></li></ul></li><li class=book-section-flat><span>Visual Illusions</span><ul><li><a href=/visual-computing-assignments/docs/visual-illusions/depth-of-field/ class=active>1. Depth of Field</a></li><li><a href=/visual-computing-assignments/docs/visual-illusions/linear-perspective/>2. Linear Perspective</a></li><li><a href=/visual-computing-assignments/docs/visual-illusions/parallax/>3. Parallax</a></li><li><a href=/visual-computing-assignments/docs/visual-illusions/joint-example/>4. A joint example of depth perception</a></li></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/visual-computing-assignments/svg/menu.svg class=book-icon alt=Menu></label>
<strong>1. Depth of Field</strong>
<label for=toc-control><img src=/visual-computing-assignments/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#depth-of-field><strong>Depth of field</strong></a><ul><li><a href=#introduction>Introduction</a></li><li><a href=#antecedents>Antecedents</a></li><li><a href=#solution>Solution</a></li><li><a href=#code-snippets>Code snippets</a></li><li><a href=#code-example>Code Example</a></li></ul></li><li><a href=#future-work>Future work</a></li></ul></nav></aside></header><article class=markdown><h1 id=depth-of-field><strong>Depth of field</strong>
<a class=anchor href=#depth-of-field>#</a></h1><h2 id=introduction>Introduction
<a class=anchor href=#introduction>#</a></h2><p>This effect describes the distance between the nearest and farthest objects in a scene that appear acceptably sharp in an image. The depth of field is affected by the focal length of the lens, the aperture of the lens, and the distance between the subject and the camera.</p><h2 id=antecedents>Antecedents
<a class=anchor href=#antecedents>#</a></h2><p>The depth of field is affected by the focal length of the lens, the aperture of the lens, the distance between the subject and the camera, and the acceptable circle of confusion. The acceptable circle of confusion is the smallest circle of confusion that is acceptable for the image. The circle of confusion is the smallest circle that can be distinguished from a point of light. The circle of confusion is affected by the resolution of the image, the size of the image, and the distance between the subject and the camera. Below is the formula for the depth of field.</p><link rel=stylesheet href=/visual-computing-assignments/katex/katex.min.css><script defer src=/visual-computing-assignments/katex/katex.min.js></script>
<script defer src=/visual-computing-assignments/katex/auto-render.min.js onload=renderMathInElement(document.body)></script><span>
\[f(x) = \dfrac{2u^2Nc}{f^2}\]</span><p>In the next diagram, one can visualize the effect of the depth of field. In the picture a subject lies within the <strong>DOF</strong> so it is in focus, on the other hand the background is out of focus and so are the items closer to the camera.</p><p><img src=https://mondracode.com/visual-computing-assignments/dof-01.png alt="Depth of field, person in range"></p><p>This effect can be understood as the light rays that are coming from the subject are focused on the sensor, while the light rays that are coming from the background are not focused on the sensor. This is why the background is out of focus, same goes for the items closer to the camera.</p><p><img src=https://mondracode.com/visual-computing-assignments/dof-02.png alt="Depth of field, light rays"></p><h2 id=solution>Solution
<a class=anchor href=#solution>#</a></h2><p>The idea behind this example is to recreate the illusion of Depth of field using Processing. The sketch is composed of a set of cards that move in the Z-axis, two selectors and a background. The selectors are used to select the range that will determine the depth of field, the cards will be either out of focus or in focus depending on their position in the Z-axis.</p><h2 id=code-snippets>Code snippets
<a class=anchor href=#code-snippets>#</a></h2><p>The code below uses the <strong>filter()</strong> function to blur the image. The <strong>filter()</strong> function is used to apply a filter to the image. The <strong>BLUR</strong> filter is used to blur the image. The <strong>4</strong> parameter is used to set the blur amount. The higher the value the more the image will be blurred.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#a6e22e>imgCardBlur</span>.<span style=color:#a6e22e>filter</span>(<span style=color:#a6e22e>BLUR</span>, <span style=color:#ae81ff>4</span>);</span></span></code></pre></div><p>Once we have the blurred image we can use the <strong>image()</strong> function to display it on the canvas. Some rectangles will be used for the cards, the <strong>drawCardWithImageBlur()</strong> function is used to draw the cards.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>drawCardWithImageBlur</span>(<span style=color:#a6e22e>img</span>, <span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>width</span>, <span style=color:#a6e22e>height</span>) {
</span></span><span style=display:flex><span><span style=color:#a6e22e>fill</span>(<span style=color:#ae81ff>255</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>strokeWeight</span>(<span style=color:#ae81ff>0.5</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>rectMode</span>(<span style=color:#a6e22e>CENTER</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>rect</span>(<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>width</span>, <span style=color:#a6e22e>height</span>);
</span></span><span style=display:flex><span><span style=color:#75715e>// draw the image within the rectangle
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>img</span>) {
</span></span><span style=display:flex><span><span style=color:#a6e22e>imageMode</span>(<span style=color:#a6e22e>CENTER</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>image</span>(<span style=color:#a6e22e>img</span>, <span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>width</span>, <span style=color:#a6e22e>height</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>}</span></span></code></pre></div><p>Once we have the cards and the blurred image. The cards will be drawn in the Z-axis, to achieve this we will use the <strong>translate()</strong> function. The <strong>translate()</strong> function is used to move the canvas in the X, Y and Z-axis. The <strong>translate()</strong> function will be used to move the canvas in the Z-axis. The <strong>drawCardWithImageBlur()</strong> function will be used to draw the cards.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#75715e>// Cards moving backwards
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>push</span>(); <span style=color:#75715e>// save the current drawing state
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>translate</span>(<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>z</span>); <span style=color:#75715e>// move the rectangle in the z-axis
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>drawCardWithImageBlur</span>(<span style=color:#a6e22e>imgCard</span>, <span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>rectWidth</span>, <span style=color:#a6e22e>rectHeight</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>drawCardWithImageBlur</span>(<span style=color:#a6e22e>imgCard</span>, <span style=color:#a6e22e>x</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>50</span>, <span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>rectWidth</span>, <span style=color:#a6e22e>rectHeight</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>drawCardWithImageBlur</span>(<span style=color:#a6e22e>imgCard</span>, <span style=color:#a6e22e>x</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>50</span>, <span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>rectWidth</span>, <span style=color:#a6e22e>rectHeight</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>pop</span>(); <span style=color:#75715e>// restore the previous drawing state
</span></span></span></code></pre></div><p>The <strong>push()</strong> and <strong>pop()</strong> functions are used to save and restore the current drawing state. The <strong>push()</strong> function is used to save the current drawing state, the <strong>pop()</strong> function is used to restore the previous drawing state. The <strong>push()</strong> and <strong>pop()</strong> functions are used to avoid the effect of the <strong>translate()</strong> function to be applied to the other elements in the sketch.</p><p>The cards are moving, however we need them to return, so as to make them come back we will use some ranges and conditionals within the <strong>draw()</strong> function. The <strong>draw()</strong> function is used to draw the elements on the canvas. The <strong>draw()</strong> function is called continuously, so the elements will be drawn continuously. The <strong>draw()</strong> function is called 60 times per second.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#75715e>// check if the ellipse has reached the end of the z-axis
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>z</span> <span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>zRangeFront</span>) {
</span></span><span style=display:flex><span><span style=color:#a6e22e>z</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>zRangeFront</span>;
</span></span><span style=display:flex><span><span style=color:#a6e22e>zSpeedVec</span> <span style=color:#960050;background-color:#1e0010>\</span><span style=color:#f92672>*=</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>z</span> <span style=color:#f92672>&lt;=</span> <span style=color:#a6e22e>zRangeBack</span>) {
</span></span><span style=display:flex><span><span style=color:#a6e22e>z</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>zRangeBack</span>;
</span></span><span style=display:flex><span><span style=color:#a6e22e>zSpeedVec</span> <span style=color:#960050;background-color:#1e0010>\</span><span style=color:#f92672>*=</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>z</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>zRangeFront</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>focalRangeInit</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>z</span> <span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>zRangeFront</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>focalRangeEnd</span>) {
</span></span><span style=display:flex><span><span style=color:#a6e22e>imgCard</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>imgCardOriginal</span>;
</span></span><span style=display:flex><span>} <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span><span style=color:#a6e22e>imgCard</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>imgCardBlur</span>;
</span></span><span style=display:flex><span>}</span></span></code></pre></div><h2 id=code-example>Code Example
<a class=anchor href=#code-example>#</a></h2><p>In this example we find two selectors, these define a range that will determine the depth of field. The selector on the upper part defines the beginning of the range, the selector on the lower part defines the end of the range. As the cards move in the Z-axis, the cards that are within the range will be in focus, the cards that are out of the range will be out of focus.</p><iframe id=depth-of-field style=width:500px;height:400px srcdoc="
        <!DOCTYPE html>
        <html>
          <head>
            <script src=https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.5.0/p5.min.js></script>
            <script src=https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.5.0/addons/p5.sound.min.js></script>
            
            
            
            
            
            <script src=/visual-computing-assignments/sketches/visual-illusions/depth-of-field.js></script>
          </head>
          <body>
          </body>
        </html>
      "></iframe><h1 id=future-work>Future work
<a class=anchor href=#future-work>#</a></h1><p>In a near future this kind of illusion maybe implemented using shaders. This will allow to create more complex effects and to have more control over the image. That is way more efficient than using the <strong>filter()</strong> function to blur the image within the draw loop.</p><p><a href=/visual-computing-assignments/ class=book-btn>Get Home</a>
<a href=https://github.com/alex-shpak/hugo-book target=_blank rel=noopener class=book-btn>Contribute</a></p></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/mondracode/visual-computing-assignments/commit/dc8912f0a984f9fb660b23d672ed31c80bfb44a2 title='Last modified by Santiago Mondragón Gómez | April 29, 2023' target=_blank rel=noopener><img src=/visual-computing-assignments/svg/calendar.svg class=book-icon alt=Calendar>
<span>April 29, 2023</span></a></div></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#depth-of-field><strong>Depth of field</strong></a><ul><li><a href=#introduction>Introduction</a></li><li><a href=#antecedents>Antecedents</a></li><li><a href=#solution>Solution</a></li><li><a href=#code-snippets>Code snippets</a></li><li><a href=#code-example>Code Example</a></li></ul></li><li><a href=#future-work>Future work</a></li></ul></nav></div></aside></main></body></html>