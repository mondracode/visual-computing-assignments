<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Raycasting # Introduction # Solution - a p5.js example # This code is a simplified implementation of a raycasting algorithm in JavaScript. The algorithm is used to render a 2D grid map consisting of with walls and an observer that can move within the scene.
The code is divided into its main components:
Constants and Variables: # degree = 0.0174533 This constant represents the conversion factor from degrees to radians."><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content="2. Raycasting"><meta property="og:description" content="Raycasting # Introduction # Solution - a p5.js example # This code is a simplified implementation of a raycasting algorithm in JavaScript. The algorithm is used to render a 2D grid map consisting of with walls and an observer that can move within the scene.
The code is divided into its main components:
Constants and Variables: # degree = 0.0174533 This constant represents the conversion factor from degrees to radians."><meta property="og:type" content="article"><meta property="og:url" content="https://mondracode.com/visual-computing-assignments/docs/rendering-and-space-transformation/raycasting/"><meta property="article:section" content="docs"><meta property="article:modified_time" content="2023-06-19T18:09:07-05:00"><title>2. Raycasting | Visual Computing Assignments</title><link rel=manifest href=/visual-computing-assignments/manifest.json><link rel=icon href=/visual-computing-assignments/favicon.png type=image/x-icon><link rel=stylesheet href=/visual-computing-assignments/book.min.f645590089b7c16b44348afb99c091ff439d5d03ced854740aa04e373e37a0dd.css integrity="sha256-9kVZAIm3wWtENIr7mcCR/0OdXQPO2FR0CqBONz43oN0=" crossorigin=anonymous><script defer src=/visual-computing-assignments/flexsearch.min.js></script>
<script defer src=/visual-computing-assignments/en.search.min.806061c597a3647b7ff8d5fe4fc7297c9d8128cef96a8504fda277c7763ee617.js integrity="sha256-gGBhxZejZHt/+NX+T8cpfJ2BKM75aoUE/aJ3x3Y+5hc=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/visual-computing-assignments/><span>Visual Computing Assignments</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li class=book-section-flat><span>Rendering and Space Transformation</span><ul><li><a href=/visual-computing-assignments/docs/rendering-and-space-transformation/light/>1. Lights</a></li><li><a href=/visual-computing-assignments/docs/rendering-and-space-transformation/raycasting/ class=active>2. Raycasting</a></li></ul></li><li class=book-section-flat><span>Visual Illusions</span><ul><li><a href=/visual-computing-assignments/docs/visual-illusions/depth-of-field/>1. Depth of Field</a></li><li><a href=/visual-computing-assignments/docs/visual-illusions/linear-perspective/>2. Linear Perspective</a></li><li><a href=/visual-computing-assignments/docs/visual-illusions/parallax/>3. Parallax</a></li><li><a href=/visual-computing-assignments/docs/visual-illusions/joint-example/>4. A joint example of depth perception</a></li></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/visual-computing-assignments/svg/menu.svg class=book-icon alt=Menu></label>
<strong>2. Raycasting</strong>
<label for=toc-control><img src=/visual-computing-assignments/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#raycasting><strong>Raycasting</strong></a><ul><li><a href=#introduction><strong>Introduction</strong></a></li><li><a href=#solution---a-p5js-example><strong>Solution - a p5.js example</strong></a><ul><li><a href=#constants-and-variables>Constants and Variables:</a></li><li><a href=#classes>Classes</a></li></ul></li><li><a href=#code><strong>Code</strong></a></li><li><a href=#conclusions><strong>Conclusions</strong></a></li></ul></li></ul></nav></aside></header><article class=markdown><h1 id=raycasting><strong>Raycasting</strong>
<a class=anchor href=#raycasting>#</a></h1><h2 id=introduction><strong>Introduction</strong>
<a class=anchor href=#introduction>#</a></h2><h2 id=solution---a-p5js-example><strong>Solution - a p5.js example</strong>
<a class=anchor href=#solution---a-p5js-example>#</a></h2><p>This code is a simplified implementation of a raycasting algorithm in JavaScript. The algorithm is used to render a 2D grid map consisting of with walls and an observer that can move within the scene.</p><p>The code is divided into its main components:</p><h3 id=constants-and-variables>Constants and Variables:
<a class=anchor href=#constants-and-variables>#</a></h3><ul><li><p><code>degree = 0.0174533</code> This constant represents the conversion factor from degrees to radians. It&rsquo;s useful to keep this conversion factor as JS
only works with radians by default.</p></li><li><p><code>observer</code>, <code>grid</code>: These variables are used to store instances of the Observer and Grid classes, respectively.</p></li><li><p><code>pressedKeys</code>: This object stores the state of keys that are currently being pressed. It is used to handle keyboard input for moving the observer.</p></li><li><p><code>rays</code>: This variable stores an instance of the Rays class, which is responsible for drawing the rays and calculating the intersections with walls.</p></li></ul><h3 id=classes>Classes
<a class=anchor href=#classes>#</a></h3><p>Observer: This class represents the observer in the scene. It has properties for position (<code>x</code> and <code>y</code>), <code>angle</code>, and direction (<code>deltaX</code> and <code>deltaY</code>). It also has methods that control the movement and rotation of the observer inside the grid world.</p><p>Grid: The grid of the scene. It has properties for the size of each cell (<code>gridSize</code>), the map layout (<code>map</code>), and the <code>width</code> and <code>height</code> of the map. It has a method for drawing the <code>grid</code> and cells.</p><p>Rays: The rays cast by the observer. It has a method for drawing the rays and calculating their intersections with walls. It uses the <code>getDistanceFromAtoB()</code> function to calculate the distance between two points, and <code>draw()</code> for drawing the rays and calculating their intersections with walls.</p><p>The variable <code>rayAngle</code> is initialized as the observer&rsquo;s angle minus 30 degrees in radians. Then it casts 64 rays arying by one degree each.</p><p>Inside the loop that creates each ray, the method calculates the horizontal (<code>hDistanceToWall</code>) and vertical (<code>vDistanceToWall</code>) distances to the nearest wall by incrementing the ray&rsquo;s position and checking for intersections with walls in each direction. The method then compares the distances and determines whether the ray hits a horizontal or vertical wall. It updates the <code>rayX</code> and <code>rayY</code> coordinates accordingly. After determining the final position of the ray, it is drawn on the canvas using line(). The method also calculates the distance from the observer to the intersection point and adjusts it based on the angle difference between the observer&rsquo;s angle and the ray&rsquo;s angle. This distance is used to fix the weird &lsquo;fish-eye&rsquo; effect that comes from raycasting walls based purely on distance.</p><p>Finally, the wall slice is drawn on the canvas using rect() based on the calculated height. Each slice is 8 pixels wide and the canvas is 512 * 1024, split in a 2D and 3D section.</p><iframe id=raycaster style=width:532px;height:1044px srcdoc="
        <!DOCTYPE html>
        <html>
          <head>
            <script src=https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.5.0/p5.min.js></script>
            <script src=https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.5.0/addons/p5.sound.min.js></script>
            
            
            
            
            
            <script src=/visual-computing-assignments/sketches/raycasting/raycaster.js></script>
          </head>
          <body>
          </body>
        </html>
      "></iframe><h2 id=code><strong>Code</strong>
<a class=anchor href=#code>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>degree</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0.0174533</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>observer</span>, <span style=color:#a6e22e>grid</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>pressedKeys</span> <span style=color:#f92672>=</span> {};
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>rays</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>setup</span>() {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>createCanvas</span>(<span style=color:#ae81ff>512</span>, <span style=color:#ae81ff>1024</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>observer</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Observer</span>(<span style=color:#ae81ff>200</span>, <span style=color:#ae81ff>200</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>grid</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Grid</span>();
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>rays</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Rays</span>(<span style=color:#a6e22e>observer</span>.<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>observer</span>.<span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>observer</span>, <span style=color:#a6e22e>grid</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>draw</span>() {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>background</span>(<span style=color:#ae81ff>220</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>grid</span>.<span style=color:#a6e22e>draw</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>observer</span>.<span style=color:#a6e22e>draw</span>();
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>rays</span>.<span style=color:#a6e22e>draw</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>observer</span>.<span style=color:#a6e22e>move</span>();
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>keyPressed</span>() {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>pressedKeys</span>[<span style=color:#a6e22e>key</span>] <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>keyReleased</span>() {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>delete</span> <span style=color:#a6e22e>pressedKeys</span>[<span style=color:#a6e22e>key</span>];
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Observer</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>constructor</span>(<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>x</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>x</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>y</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>y</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>angle</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>deltaX</span> <span style=color:#f92672>=</span> Math.<span style=color:#a6e22e>cos</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>angle</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>deltaY</span> <span style=color:#f92672>=</span> Math.<span style=color:#a6e22e>sin</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>angle</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>draw</span> <span style=color:#f92672>=</span> () =&gt; {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>strokeWeight</span>(<span style=color:#ae81ff>5</span>);
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>point</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>x</span>, <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>y</span>);
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>line</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>x</span>, <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>y</span>, <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>x</span> <span style=color:#f92672>+</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>deltaX</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>10</span>, <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>y</span> <span style=color:#f92672>+</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>deltaY</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>10</span>);
</span></span><span style=display:flex><span>    };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>move</span> <span style=color:#f92672>=</span> () =&gt; {
</span></span><span style=display:flex><span>      <span style=color:#75715e>// keypress logic - 87 for W and 83 for S
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>pressedKeys</span>.<span style=color:#a6e22e>a</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>angle</span> <span style=color:#f92672>-=</span> <span style=color:#ae81ff>0.03</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>angle</span> <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>angle</span> <span style=color:#f92672>+=</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>PI</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>deltaX</span> <span style=color:#f92672>=</span> Math.<span style=color:#a6e22e>cos</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>angle</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>deltaY</span> <span style=color:#f92672>=</span> Math.<span style=color:#a6e22e>sin</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>angle</span>);
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>pressedKeys</span>.<span style=color:#a6e22e>d</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>angle</span> <span style=color:#f92672>+=</span> <span style=color:#ae81ff>0.03</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>angle</span> <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>PI</span>) {
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>angle</span> <span style=color:#f92672>-=</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>PI</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>deltaX</span> <span style=color:#f92672>=</span> Math.<span style=color:#a6e22e>cos</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>angle</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>deltaY</span> <span style=color:#f92672>=</span> Math.<span style=color:#a6e22e>sin</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>angle</span>);
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>pressedKeys</span>.<span style=color:#a6e22e>w</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>x</span> <span style=color:#f92672>+=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>deltaX</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>y</span> <span style=color:#f92672>+=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>deltaY</span>;
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>pressedKeys</span>.<span style=color:#a6e22e>s</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>x</span> <span style=color:#f92672>-=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>deltaX</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>y</span> <span style=color:#f92672>-=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>deltaY</span>;
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    };
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Grid</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>constructor</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>gridSize</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>64</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>map</span> <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>      [<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>],
</span></span><span style=display:flex><span>      [<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>],
</span></span><span style=display:flex><span>      [<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>],
</span></span><span style=display:flex><span>      [<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>],
</span></span><span style=display:flex><span>      [<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>],
</span></span><span style=display:flex><span>      [<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>],
</span></span><span style=display:flex><span>      [<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>],
</span></span><span style=display:flex><span>      [<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>],
</span></span><span style=display:flex><span>    ];
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mapWidth</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>map</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>length</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mapHeight</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>map</span>.<span style=color:#a6e22e>length</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>drawCell</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span>) =&gt; {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>fill</span>(<span style=color:#ae81ff>51</span>);
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>strokeWeight</span>(<span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>square</span>(<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span>, <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>gridSize</span>);
</span></span><span style=display:flex><span>    };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>draw</span> <span style=color:#f92672>=</span> () =&gt; {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>vIndex</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>vIndex</span> <span style=color:#f92672>&lt;</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mapHeight</span>; <span style=color:#a6e22e>vIndex</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>hIndex</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>hIndex</span> <span style=color:#f92672>&lt;</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mapWidth</span>; <span style=color:#a6e22e>hIndex</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>map</span>[<span style=color:#a6e22e>vIndex</span>][<span style=color:#a6e22e>hIndex</span>] <span style=color:#f92672>===</span> <span style=color:#ae81ff>1</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>drawCell</span>(<span style=color:#a6e22e>hIndex</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>gridSize</span>, <span style=color:#a6e22e>vIndex</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>gridSize</span>);
</span></span><span style=display:flex><span>          }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    };
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Rays</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>constructor</span>(<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>observer</span>, <span style=color:#a6e22e>grid</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>getDistanceFromAtoB</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>ax</span>, <span style=color:#a6e22e>ay</span>, <span style=color:#a6e22e>bx</span>, <span style=color:#a6e22e>by</span>) =&gt; {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> Math.<span style=color:#a6e22e>sqrt</span>((<span style=color:#a6e22e>bx</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>ax</span>) <span style=color:#f92672>**</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>+</span> (<span style=color:#a6e22e>by</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>ay</span>) <span style=color:#f92672>**</span> <span style=color:#ae81ff>2</span>);
</span></span><span style=display:flex><span>    };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>draw</span> <span style=color:#f92672>=</span> () =&gt; {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>rayXPosition</span>, <span style=color:#a6e22e>rayYPosition</span>, <span style=color:#a6e22e>rayAngle</span>;
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>rayX</span>, <span style=color:#a6e22e>rayY</span>, <span style=color:#a6e22e>rayXOffset</span>, <span style=color:#a6e22e>rayYOffset</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>rayAngle</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>observer</span>.<span style=color:#a6e22e>angle</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>degree</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>30</span>;
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>rayAngle</span> <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>rayAngle</span> <span style=color:#f92672>+=</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>PI</span>;
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>rayAngle</span> <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>PI</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>rayAngle</span> <span style=color:#f92672>-=</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>PI</span>;
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>index</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>index</span> <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>64</span>; <span style=color:#a6e22e>index</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// H check
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>drawDistance</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>finalDistance</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>hDistanceToWall</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1000000</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>rayXIntersection</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>observer</span>.<span style=color:#a6e22e>x</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>rayYIntersection</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>observer</span>.<span style=color:#a6e22e>y</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>angleCot</span> <span style=color:#f92672>=</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1.0</span> <span style=color:#f92672>/</span> Math.<span style=color:#a6e22e>tan</span>(<span style=color:#a6e22e>rayAngle</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>rayAngle</span> <span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>PI</span>) {
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>rayY</span> <span style=color:#f92672>=</span> ((Math.<span style=color:#a6e22e>floor</span>(<span style=color:#a6e22e>observer</span>.<span style=color:#a6e22e>y</span>) <span style=color:#f92672>&gt;&gt;</span> <span style=color:#ae81ff>6</span>) <span style=color:#f92672>&lt;&lt;</span> <span style=color:#ae81ff>6</span>) <span style=color:#f92672>-</span> <span style=color:#ae81ff>0.0001</span>;
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>rayX</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>observer</span>.<span style=color:#a6e22e>y</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>rayY</span>) <span style=color:#f92672>*</span> <span style=color:#a6e22e>angleCot</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>observer</span>.<span style=color:#a6e22e>x</span>;
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>rayYOffset</span> <span style=color:#f92672>=</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>64</span>;
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>rayXOffset</span> <span style=color:#f92672>=</span> <span style=color:#f92672>-</span><span style=color:#a6e22e>rayYOffset</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>angleCot</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>rayAngle</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>PI</span>) {
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>rayY</span> <span style=color:#f92672>=</span> ((Math.<span style=color:#a6e22e>floor</span>(<span style=color:#a6e22e>observer</span>.<span style=color:#a6e22e>y</span>) <span style=color:#f92672>&gt;&gt;</span> <span style=color:#ae81ff>6</span>) <span style=color:#f92672>&lt;&lt;</span> <span style=color:#ae81ff>6</span>) <span style=color:#f92672>+</span> <span style=color:#ae81ff>64</span>;
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>rayX</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>observer</span>.<span style=color:#a6e22e>y</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>rayY</span>) <span style=color:#f92672>*</span> <span style=color:#a6e22e>angleCot</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>observer</span>.<span style=color:#a6e22e>x</span>;
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>rayYOffset</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>64</span>;
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>rayXOffset</span> <span style=color:#f92672>=</span> <span style=color:#f92672>-</span><span style=color:#a6e22e>rayYOffset</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>angleCot</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>rayAngle</span> <span style=color:#f92672>===</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>rayAngle</span> <span style=color:#f92672>===</span> <span style=color:#a6e22e>PI</span>) {
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>rayX</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>observer</span>.<span style=color:#a6e22e>x</span>;
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>rayY</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>observer</span>.<span style=color:#a6e22e>y</span>;
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>drawDistance</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>8</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>while</span> (<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>drawDistance</span> <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>8</span>) {
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>rayXPosition</span> <span style=color:#f92672>=</span> Math.<span style=color:#a6e22e>floor</span>(<span style=color:#a6e22e>rayX</span>) <span style=color:#f92672>&gt;&gt;</span> <span style=color:#ae81ff>6</span>;
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>rayYPosition</span> <span style=color:#f92672>=</span> Math.<span style=color:#a6e22e>floor</span>(<span style=color:#a6e22e>rayY</span>) <span style=color:#f92672>&gt;&gt;</span> <span style=color:#ae81ff>6</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>if</span> (
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>rayXPosition</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>grid</span>.<span style=color:#a6e22e>map</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>length</span> <span style=color:#f92672>&amp;&amp;</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>rayXPosition</span> <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>&amp;&amp;</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>rayYPosition</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>grid</span>.<span style=color:#a6e22e>map</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>&amp;&amp;</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>rayYPosition</span> <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>&amp;&amp;</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>grid</span>.<span style=color:#a6e22e>map</span>[<span style=color:#a6e22e>rayYPosition</span>][<span style=color:#a6e22e>rayXPosition</span>] <span style=color:#f92672>===</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>          ) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>rayXIntersection</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>rayX</span>;
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>rayYIntersection</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>rayY</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>hDistanceToWall</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>getDistanceFromAtoB</span>(<span style=color:#a6e22e>observer</span>.<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>observer</span>.<span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>rayXIntersection</span>, <span style=color:#a6e22e>rayYIntersection</span>);
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>drawDistance</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>8</span>;
</span></span><span style=display:flex><span>          } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>rayX</span> <span style=color:#f92672>+=</span> <span style=color:#a6e22e>rayXOffset</span>;
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>rayY</span> <span style=color:#f92672>+=</span> <span style=color:#a6e22e>rayYOffset</span>;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>drawDistance</span> <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>          }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// V check
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>drawDistance</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>vDistanceToWall</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1000000</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>rayVXIntersection</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>observer</span>.<span style=color:#a6e22e>x</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>rayVYIntersection</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>observer</span>.<span style=color:#a6e22e>y</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>angleNTan</span> <span style=color:#f92672>=</span> <span style=color:#f92672>-</span>Math.<span style=color:#a6e22e>tan</span>(<span style=color:#a6e22e>rayAngle</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>rayAngle</span> <span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>PI</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>rayAngle</span> <span style=color:#f92672>&lt;</span> (<span style=color:#ae81ff>3</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>PI</span>) <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>) {
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>rayX</span> <span style=color:#f92672>=</span> ((Math.<span style=color:#a6e22e>floor</span>(<span style=color:#a6e22e>observer</span>.<span style=color:#a6e22e>x</span>) <span style=color:#f92672>&gt;&gt;</span> <span style=color:#ae81ff>6</span>) <span style=color:#f92672>&lt;&lt;</span> <span style=color:#ae81ff>6</span>) <span style=color:#f92672>-</span> <span style=color:#ae81ff>0.0001</span>;
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>rayY</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>observer</span>.<span style=color:#a6e22e>x</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>rayX</span>) <span style=color:#f92672>*</span> <span style=color:#a6e22e>angleNTan</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>observer</span>.<span style=color:#a6e22e>y</span>;
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>rayXOffset</span> <span style=color:#f92672>=</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>64</span>;
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>rayYOffset</span> <span style=color:#f92672>=</span> <span style=color:#f92672>-</span><span style=color:#a6e22e>rayXOffset</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>angleNTan</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>rayAngle</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>PI</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>rayAngle</span> <span style=color:#f92672>&gt;</span> (<span style=color:#ae81ff>3</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>PI</span>) <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>) {
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>rayX</span> <span style=color:#f92672>=</span> ((Math.<span style=color:#a6e22e>floor</span>(<span style=color:#a6e22e>observer</span>.<span style=color:#a6e22e>x</span>) <span style=color:#f92672>&gt;&gt;</span> <span style=color:#ae81ff>6</span>) <span style=color:#f92672>&lt;&lt;</span> <span style=color:#ae81ff>6</span>) <span style=color:#f92672>+</span> <span style=color:#ae81ff>64</span>;
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>rayY</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>observer</span>.<span style=color:#a6e22e>x</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>rayX</span>) <span style=color:#f92672>*</span> <span style=color:#a6e22e>angleNTan</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>observer</span>.<span style=color:#a6e22e>y</span>;
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>rayXOffset</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>64</span>;
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>rayYOffset</span> <span style=color:#f92672>=</span> <span style=color:#f92672>-</span><span style=color:#a6e22e>rayXOffset</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>angleNTan</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>rayAngle</span> <span style=color:#f92672>===</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>rayAngle</span> <span style=color:#f92672>===</span> <span style=color:#a6e22e>PI</span>) {
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>rayY</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>observer</span>.<span style=color:#a6e22e>y</span>;
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>rayX</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>observer</span>.<span style=color:#a6e22e>x</span>;
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>drawDistance</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>8</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>while</span> (<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>drawDistance</span> <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>8</span>) {
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>rayXPosition</span> <span style=color:#f92672>=</span> Math.<span style=color:#a6e22e>floor</span>(<span style=color:#a6e22e>rayX</span>) <span style=color:#f92672>&gt;&gt;</span> <span style=color:#ae81ff>6</span>;
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>rayYPosition</span> <span style=color:#f92672>=</span> Math.<span style=color:#a6e22e>floor</span>(<span style=color:#a6e22e>rayY</span>) <span style=color:#f92672>&gt;&gt;</span> <span style=color:#ae81ff>6</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>if</span> (
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>rayXPosition</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>grid</span>.<span style=color:#a6e22e>map</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>length</span> <span style=color:#f92672>&amp;&amp;</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>rayXPosition</span> <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>&amp;&amp;</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>rayYPosition</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>grid</span>.<span style=color:#a6e22e>map</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>&amp;&amp;</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>rayYPosition</span> <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>&amp;&amp;</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>grid</span>.<span style=color:#a6e22e>map</span>[<span style=color:#a6e22e>rayYPosition</span>][<span style=color:#a6e22e>rayXPosition</span>] <span style=color:#f92672>===</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>          ) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>rayVXIntersection</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>rayX</span>;
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>rayVYIntersection</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>rayY</span>;
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>vDistanceToWall</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>getDistanceFromAtoB</span>(<span style=color:#a6e22e>observer</span>.<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>observer</span>.<span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>rayVXIntersection</span>, <span style=color:#a6e22e>rayVYIntersection</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>drawDistance</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>8</span>;
</span></span><span style=display:flex><span>          } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>rayX</span> <span style=color:#f92672>+=</span> <span style=color:#a6e22e>rayXOffset</span>;
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>rayY</span> <span style=color:#f92672>+=</span> <span style=color:#a6e22e>rayYOffset</span>;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>drawDistance</span> <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>          }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>vDistanceToWall</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>hDistanceToWall</span>) {
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>fill</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>120</span>, <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>rayX</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>rayVXIntersection</span>;
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>rayY</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>rayVYIntersection</span>;
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>finalDistance</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>vDistanceToWall</span>;
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>fill</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>150</span>, <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>rayX</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>rayXIntersection</span>;
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>rayY</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>rayYIntersection</span>;
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>finalDistance</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>hDistanceToWall</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>strokeWeight</span>(<span style=color:#ae81ff>3</span>);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>stroke</span>(<span style=color:#ae81ff>255</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>line</span>(<span style=color:#a6e22e>observer</span>.<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>observer</span>.<span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>rayX</span>, <span style=color:#a6e22e>rayY</span>);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>stroke</span>(<span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// rendering
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>angleDiff</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>observer</span>.<span style=color:#a6e22e>angle</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>rayAngle</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>angleDiff</span> <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>angleDiff</span> <span style=color:#f92672>+=</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>PI</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>angleDiff</span> <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>PI</span>) {
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>angleDiff</span> <span style=color:#f92672>-=</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>PI</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>finalDistance</span> <span style=color:#f92672>*=</span> Math.<span style=color:#a6e22e>cos</span>(<span style=color:#a6e22e>angleDiff</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>lineHeight</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>grid</span>.<span style=color:#a6e22e>mapWidth</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>512</span>) <span style=color:#f92672>/</span> <span style=color:#a6e22e>finalDistance</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>lineHeight</span> <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>512</span>) {
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>lineHeight</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>512</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>lineBaseline</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>256</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>lineHeight</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>noStroke</span>();
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>rect</span>(<span style=color:#a6e22e>index</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>8</span>, <span style=color:#ae81ff>512</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>lineBaseline</span>, <span style=color:#ae81ff>8</span>, <span style=color:#a6e22e>lineHeight</span>);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>stroke</span>(<span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>rayAngle</span> <span style=color:#f92672>+=</span> <span style=color:#a6e22e>degree</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>rayAngle</span> <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>rayAngle</span> <span style=color:#f92672>+=</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>PI</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>rayAngle</span> <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>PI</span>) {
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>rayAngle</span> <span style=color:#f92672>-=</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>PI</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    };
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=conclusions><strong>Conclusions</strong>
<a class=anchor href=#conclusions>#</a></h2><p>The ability to control different types of lights, adjust their position and play with lighting effects offers endless possibilities to create atmospheres, highlight specific objects and convey emotions through the right combination of lights and shadows.</p><p>Visual computing is an exciting and constantly evolving field that combines programming with visual expression. Through the exploration of lighting, 3D modeling and rendering techniques, professionals can open new doors of creativity and deliver stunning visual experiences in various industries and disciplines.</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/mondracode/visual-computing-assignments/commit/0cee094526553f3e8b9b877c1bb2b587ac04e918 title='Last modified by Santiago Mondragón Gómez | June 19, 2023' target=_blank rel=noopener><img src=/visual-computing-assignments/svg/calendar.svg class=book-icon alt=Calendar>
<span>June 19, 2023</span></a></div></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#raycasting><strong>Raycasting</strong></a><ul><li><a href=#introduction><strong>Introduction</strong></a></li><li><a href=#solution---a-p5js-example><strong>Solution - a p5.js example</strong></a><ul><li><a href=#constants-and-variables>Constants and Variables:</a></li><li><a href=#classes>Classes</a></li></ul></li><li><a href=#code><strong>Code</strong></a></li><li><a href=#conclusions><strong>Conclusions</strong></a></li></ul></li></ul></nav></div></aside></main></body></html>